@using Microsoft.AspNetCore.Components.Authorization
@using FrontBlazor.Services
@inject NavigationManager NavigationManager
@inject AuthService AuthService

<!-- Contenedor superior del menú de navegación -->
<!-- top-row: define altura y posición, ps-3: padding izquierdo, navbar navbar-dark: estilos de Bootstrap para la barra de navegación -->
<div class="top-row ps-3 navbar navbar-dark">
    <!-- container-fluid: contenedor que ocupa todo el ancho disponible (Bootstrap) -->
    <div class="container-fluid">
        <!-- navbar-brand: estilo para el logo/nombre de la aplicación -->
        <!-- href="": enlace a la página de inicio -->
        <a class="navbar-brand" href="">FrontBlazor</a>
        
        <!-- Botón hamburguesa para mostrar/ocultar el menú en dispositivos móviles -->
        <!-- title: texto que aparece al pasar el cursor sobre el botón -->
        <!-- navbar-toggler: estilo Bootstrap para el botón de alternar menú -->
        <!-- @onclick: evento que llama al método ToggleNavMenu cuando se hace clic -->
        <button title="Navigation menu" class="navbar-toggler" @onclick="@ToggleNavMenu">
            <!-- Icono de tres líneas horizontales (hamburguesa) -->
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</div>

<!-- Contenedor principal del menú de navegación -->
<!-- @NavMenuCssClass: clase dinámica que controla si el menú está colapsado o no -->
<!-- nav-scrollable: permite desplazamiento si el menú es muy largo -->
<!-- @onclick: colapsa el menú al hacer clic en cualquier opción (en dispositivos móviles) -->
<div class="@NavMenuCssClass nav-scrollable" @onclick="@ToggleNavMenu">
    <!-- Elemento de navegación con disposición en columna vertical -->
    <nav class="flex-column">
        <!-- Primera opción de menú: Home -->
        <!-- nav-item: estilo para elemento de navegación, px-3: padding horizontal -->
        <div class="nav-item px-3">
            <!-- NavLink: componente especial de Blazor para navegación que resalta automáticamente la página actual -->
            <!-- href="": enlace a la ruta raíz -->
            <!-- Match="NavLinkMatch.All": solo se activa cuando la ruta es exactamente "/" -->
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <!-- Icono para la opción Home -->
                <!-- bi bi-house-door-fill-nav-menu: clases para el icono de casa -->
                <!-- aria-hidden="true": oculta el icono para lectores de pantalla -->
                <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Home
            </NavLink>
        </div>
        
        <!-- Segunda opción de menú: Counter -->
        <div class="nav-item px-3">
            <!-- href="login": enlace a la página de contador -->
            <NavLink class="nav-link" href="login">
                <!-- Icono para la opción Counter (símbolo de más en un cuadrado) -->
                <span class="bi bi-plus-square-fill-nav-menu" aria-hidden="true"></span> login
            </NavLink>
        </div>
        
        <!-- cuarta opción de menú: actor -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="actor">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> actor
            </NavLink>
        </div>

        <!-- cuarta opción de menú: articulo -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="articulo">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> articulo
            </NavLink>
        </div>

        <!-- cuarta opción de menú: articulo -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="fuentesporindicador">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> fuentes por indicador
            </NavLink>
        </div>

        <!-- cuarta opción de menú: articulo -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="indicador">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> indicador
            </NavLink>
        </div>

        <!-- cuarta opción de menú: articulo -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="literal">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> literal
            </NavLink>
        </div>

        <!-- cuarta opción de menú: articulo -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="numeral">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> numeral
            </NavLink>
        </div>

        <!-- cuarta opción de menú: articulo -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="paragrafo">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> parrafo
            </NavLink>
        </div>

        <!-- cuarta opción de menú: articulo -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="represenvisualporindicador">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> representacion visual por indicador
            </NavLink>
        </div>

        <!-- cuarta opción de menú: articulo -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="responsablesporindicador">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> responsable por indicador
            </NavLink>
        </div>

        <!-- cuarta opción de menú: articulo -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="resultadoindicador">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> resultado por indicador
            </NavLink>
        </div>

        <!-- cuarta opción de menú: articulo -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="rolusuario">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> Rol de usuario
            </NavLink>
        </div>

        <!-- cuarta opción de menú: tipoactor -->
        <div class="nav-item px-3">
            <!-- href="tipoactor": enlace a la página del clima -->
            <NavLink class="nav-link" href="tipoactor">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> tipoactor
            </NavLink>
        </div>

        <!-- cuarta opción de menú: articulo -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="variable">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> variable
            </NavLink>
        </div>

        <!-- cuarta opción de menú: articulo -->
        <div class="nav-item px-3">
            <!-- href="actor": enlace a la página del clima -->
            <NavLink class="nav-link" href="variablesporindicador">
                <!-- Icono para la opción Weather (lista anidada) -->
                <span class="bi bi-list-nested-nav-menu" aria-hidden="true"></span> variables por indicador
            </NavLink>
        </div>

<!-- Agregar este bloque después de las opciones existentes -->

        <!-- Opciones de menú para usuario autenticado -->
        <AuthorizeView>
            <Authorized>
                <!-- Aquí puedes agregar más opciones específicas para usuarios autenticados -->

                <!-- Opción de menú: Cerrar Sesión -->
                <div class="nav-item px-3">
                    <!-- @onclick: evento que llama al método HandleLogout cuando se hace clic -->
                    <!-- @onclick:preventDefault: evita el comportamiento por defecto del enlace -->
                    <a class="nav-link" href="#" @onclick="HandleLogout" @onclick:preventDefault>
                        <!-- Icono para la opción Cerrar Sesión -->
                        <!-- oi oi-account-logout: clases para el icono de cerrar sesión -->
                        <!-- aria-hidden="true": oculta el icono para lectores de pantalla -->
                        <span class="oi oi-account-logout" aria-hidden="true"></span> Cerrar Sesión
                    </a>
                </div>
            </Authorized>
            <NotAuthorized>
                <!-- Opción de menú: Iniciar Sesión (para usuarios no autenticados) -->
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="login">
                        <!-- Icono para la opción Iniciar Sesión -->
                        <!-- oi oi-account-login: clases para el icono de iniciar sesión -->
                        <!-- aria-hidden="true": oculta el icono para lectores de pantalla -->
                        <span class="oi oi-account-login" aria-hidden="true"></span> Iniciar Sesión
                    </NavLink>
                </div>
            </NotAuthorized>
        </AuthorizeView>
    </nav>
</div>

<!-- Bloque de código C# que define la lógica del componente -->
@code {
    // Variable que controla si el menú está colapsado (valor inicial: true)
    private bool collapseNavMenu = true;

    // Propiedad que devuelve la clase CSS según el estado del menú
    // Si está colapsado, devuelve "collapse", de lo contrario, null
    // El signo ? indica que puede devolver null (string nullable)
    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    // Método que invierte el estado del menú (colapsado/expandido)
    // Se ejecuta cuando se hace clic en el botón hamburguesa
    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    // Método que maneja el cierre de sesión
    // Se ejecuta cuando se hace clic en el enlace "Cerrar Sesión"
    private async Task HandleLogout()
    {
        // Llama al servicio de autenticación para cerrar sesión
        await AuthService.Logout();
        
        // Redirige a la página de inicio de sesión
        NavigationManager.NavigateTo("/login", true);
    }
}